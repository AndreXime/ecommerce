---
import {
    Headset,
    Menu,
    Package,
    Search,
    ShoppingBag,
    User,
    X,
    Zap,
} from "lucide-preact";

interface Props {
    hideSearch?: boolean;
}

const { hideSearch } = Astro.props;
---

<header class="bg-white border-b border-gray-200 sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4">
        <div class="relative flex flex-row justify-between items-center h-10">
            <div class="flex items-center gap-4 z-10 relative">
                <button
                    id="menu-open-btn"
                    class="md:hidden text-gray-600 hover:text-blue-600 transition focus:outline-none"
                    aria-label="Abrir menu"
                    aria-expanded="false"
                    aria-controls="sidebar-menu"
                >
                    <Menu size={26} aria-hidden="true" />
                </button>

                <a
                    href="/login"
                    class="hidden md:flex items-center text-gray-600 hover:text-blue-600 cursor-pointer transition"
                >
                    <span class="text-sm font-medium">Minha Conta</span>
                </a>
            </div>

            <div
                class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 z-0 w-max text-center"
            >
                <a href="/" class="group flex items-center justify-center">
                    <span
                        class="flex gap-2 items-center text-xl font-bold tracking-tight text-blue-700 group-hover:text-blue-900 transition"
                    >
                        <span class="text-blue-600">
                            <Zap class="text-xl" />
                        </span>
                        <span class="whitespace-nowrap">
                            Emporium<span class="hidden min-[400px]:inline">
                                da Tecnologia</span
                            >
                        </span>
                    </span>
                </a>
            </div>

            <div
                class="flex items-center gap-6 justify-end z-10 relative bg-white/0"
            >
                <nav
                    class="hidden md:flex items-center space-x-4 text-sm font-medium text-gray-600"
                >
                    <a
                        href="/atendimento"
                        class="hover:text-blue-600 transition">Atendimento</a
                    >
                    <a href="/produtos" class="hover:text-blue-600 transition"
                        >Produtos</a
                    >
                </nav>

                <a
                    href="/carrinho"
                    aria-label="Carrinho de compras"
                    class="relative cursor-pointer text-gray-600 hover:text-blue-600 transition flex items-center"
                >
                    <ShoppingBag class="text-2xl" aria-hidden="true" />
                    <span
                        id="cart-count"
                        aria-live="polite"
                        aria-label="itens no carrinho"
                        class="absolute -top-2 -right-2 bg-blue-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center hidden"
                    >
                        0
                    </span>
                </a>
            </div>
        </div>

        {
            !hideSearch && (
                <div class="flex justify-center w-full mt-4">
                    <form
                        action="/produtos"
                        method="GET"
                        class="relative w-full max-w-2xl"
                    >
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <Search class="text-gray-400" />
                        </div>
                        <label for="header-search" class="sr-only">Buscar produtos</label>
                        <input
                            type="search"
                            name="s"
                            id="header-search"
                            class="block w-full pl-10 pr-4 py-3 border border-gray-300 rounded-full leading-5 bg-gray-50 text-gray-900 placeholder-gray-500 focus:outline-none focus:bg-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 sm:text-sm transition shadow-sm"
                            placeholder="Buscar produtos..."
                        />
                    </form>
                </div>
            )
        }
    </div>
</header>

<div
    id="sidebar-overlay"
    class="fixed hidden inset-0 bg-black/50 z-[60] invisible opacity-0 transition-opacity duration-300"
>
</div>

<aside
    id="sidebar-menu"
    aria-label="Menu principal"
    aria-hidden="true"
    class="fixed top-0 left-0 w-72 h-full bg-white z-[70] shadow-2xl transform -translate-x-full transition-transform duration-300 flex flex-col"
>
    <div
        class="p-5 border-b border-gray-100 flex justify-between items-center bg-blue-50"
    >
        <span class="font-bold text-lg text-blue-700">Menu</span>
        <button
            id="menu-close-btn"
            class="text-gray-500 hover:text-red-500 transition outline-none"
            aria-label="Fechar menu"
        >
            <X class="text-xl" aria-hidden="true" />
        </button>
    </div>

    <nav class="flex-1 overflow-y-auto py-4">
        <div
            class="px-4 pb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider"
        >
            Conta
        </div>
        <a
            href="/login"
            class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-50 hover:text-blue-600 transition border-l-4 border-transparent hover:border-blue-600"
        >
            <User class="w-6 mr-2" /> Minha Conta
        </a>
        <a
            href="/carrinho"
            class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-50 hover:text-blue-600 transition border-l-4 border-transparent hover:border-blue-600"
        >
            <ShoppingBag class="w-6 mr-2" /> Meu Carrinho
        </a>

        <div
            class="mt-6 px-4 pb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider"
        >
            Navegação
        </div>
        <a
            href="/produtos"
            class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-50 hover:text-blue-600 transition border-l-4 border-transparent hover:border-blue-600"
        >
            <Package class="w-6 mr-2" /> Produtos
        </a>
        <a
            href="/atendimento"
            class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-50 hover:text-blue-600 transition border-l-4 border-transparent hover:border-blue-600"
        >
            <Headset class="w-6 mr-2" /> Atendimento
        </a>
    </nav>
</aside>

<script>
    const menuOpenBtn = document.getElementById("menu-open-btn");
    const menuCloseBtn = document.getElementById("menu-close-btn");
    const sidebarOverlay = document.getElementById("sidebar-overlay");
    const sidebarMenu = document.getElementById("sidebar-menu");

    function toggleMenu() {
        const isOpen = !sidebarMenu?.classList.contains("-translate-x-full");

        if (!isOpen) {
            sidebarMenu?.classList.remove("-translate-x-full");
            sidebarMenu?.setAttribute("aria-hidden", "false");
            sidebarOverlay?.classList.remove("invisible", "opacity-0", "hidden");
            menuOpenBtn?.setAttribute("aria-expanded", "true");
            document.body.style.overflow = "hidden";
        } else {
            sidebarMenu?.classList.add("-translate-x-full");
            sidebarMenu?.setAttribute("aria-hidden", "true");
            sidebarOverlay?.classList.add("invisible", "opacity-0", "hidden");
            menuOpenBtn?.setAttribute("aria-expanded", "false");
            document.body.style.overflow = "";
        }
    }

    menuOpenBtn?.addEventListener("click", toggleMenu);
    menuCloseBtn?.addEventListener("click", toggleMenu);
    sidebarOverlay?.addEventListener("click", toggleMenu);
</script>
<script>
    const renderCartCount = () => {
        const cart = JSON.parse(localStorage.getItem("cart") || "[]");
        const badge = document.getElementById("cart-count");

        if (!badge) return;

        badge.innerText = cart.length;
        badge.classList.toggle("hidden", cart.length === 0);
    };

    renderCartCount();
    window.addEventListener("cart-updated", renderCartCount);
</script>
