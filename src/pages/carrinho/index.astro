---
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Layout from "@/layout/layout.astro";
import { getProductById, formatPrice } from "@/lib/productsMethods";
import type { CartItem } from "@/lib/productsTypes";

const cartItemIds = [
    { id: "aerobook-pro-15", qty: 1, variant: "Cinza Espacial, 512GB" },
    { id: "soundscape-anc", qty: 2, variant: "Preto Matte" },
];

const cartItems: CartItem[] = cartItemIds
    .map((item) => {
        const product = getProductById(item.id);
        if (!product) return null;

        return {
            ...product,
            quantity: item.qty,
            selectedVariant: item.variant,
        } as CartItem;
    })
    .filter((item): item is CartItem => item !== null);

const paymentMethods = [
    { icon: "fab fa-cc-visa", colorClass: "hover:text-blue-800" },
    { icon: "fab fa-cc-mastercard", colorClass: "hover:text-red-600" },
    { icon: "fab fa-cc-paypal", colorClass: "hover:text-blue-500" },
    { icon: "fab fa-cc-apple-pay", colorClass: "hover:text-black" },
];

const cartTotal = cartItems.reduce(
    (acc, item) => acc + item.price * item.quantity,
    0,
);

const totalItems = cartItems.reduce((acc, item) => acc + item.quantity, 0);
---

<Layout title="Emporium da Tecnologia" description="">
    <Header />
    <main class="flex-grow container mx-auto px-4 py-8">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-8">
            Seu Carrinho
        </h1>

        <div class="flex flex-col lg:flex-row gap-8">
            <div class="flex-grow space-y-4">
                <div
                    class="hidden md:grid grid-cols-12 gap-4 text-sm font-semibold text-gray-500 pb-2 border-b border-gray-200"
                >
                    <div class="col-span-6">Produto</div>
                    <div class="col-span-2 text-center">Preço</div>
                    <div class="col-span-2 text-center">Quantidade</div>
                    <div class="col-span-2 text-right">Total</div>
                </div>

                {
                    cartItems.map((item) => (
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 md:p-6 flex flex-col md:grid md:grid-cols-12 gap-4 items-center">
                            <div class="col-span-6 flex items-center w-full">
                                <div class="h-24 w-24 flex-shrink-0 overflow-hidden rounded-md border border-gray-200">
                                    <img
                                        src={item.images[0]}
                                        alt={item.name}
                                        class="h-full w-full object-cover object-center"
                                    />
                                </div>
                                <div class="ml-4 flex flex-col">
                                    <span class="text-xs text-blue-600 font-semibold uppercase tracking-wide">
                                        {item.tag}
                                    </span>
                                    <h3 class="text-base font-bold text-gray-900">
                                        {item.name}
                                    </h3>
                                    <p class="text-sm text-gray-500 mt-1">
                                        {item.selectedVariant}
                                    </p>
                                    <button class="text-xs text-red-500 hover:text-red-700 font-medium mt-2 flex items-center md:hidden">
                                        <i class="far fa-trash-alt mr-1" />{" "}
                                        Remover
                                    </button>
                                </div>
                            </div>

                            <div class="col-span-2 text-center w-full flex justify-between md:block md:w-auto mt-4 md:mt-0">
                                <span class="md:hidden text-gray-500 text-sm">
                                    Preço:
                                </span>
                                <span class="text-gray-900 font-medium">
                                    {formatPrice(item.price)}
                                </span>
                            </div>

                            <div class="col-span-2 flex justify-center w-full md:w-auto mt-4 md:mt-0">
                                <div class="flex items-center border border-gray-300 rounded-lg">
                                    <button class="px-3 py-1 text-gray-600 hover:bg-gray-100 rounded-l-lg transition">
                                        -
                                    </button>
                                    <input
                                        type="number"
                                        value={item.quantity}
                                        class="w-12 text-center border-none focus:ring-0 p-1 text-sm font-semibold text-gray-900"
                                        readonly
                                    />
                                    <button class="px-3 py-1 text-gray-600 hover:bg-gray-100 rounded-r-lg transition">
                                        +
                                    </button>
                                </div>
                            </div>

                            <div class="col-span-2 text-right w-full flex justify-between md:block md:w-auto mt-4 md:mt-0 items-center">
                                <span class="md:hidden text-gray-500 text-sm">
                                    Total:
                                </span>
                                <div class="flex flex-col items-end">
                                    <span class="text-lg font-bold text-gray-900">
                                        {formatPrice(
                                            item.price * item.quantity,
                                        )}
                                    </span>
                                    <button class="text-xs text-gray-400 hover:text-red-600 font-medium mt-1 hidden md:flex items-center transition">
                                        <i class="far fa-trash-alt mr-1" />{" "}
                                        Remover
                                    </button>
                                </div>
                            </div>
                        </div>
                    ))
                }

                <div class="pt-4">
                    <a
                        href="products.html"
                        class="inline-flex items-center text-blue-600 font-medium hover:text-blue-800 transition"
                    >
                        <i class="fas fa-arrow-left mr-2"></i> Continuar Comprando
                    </a>
                </div>
            </div>

            <div class="w-full lg:w-1/3 flex-shrink-0">
                <div
                    class="bg-white p-6 rounded-xl border border-gray-200 shadow-lg sticky top-24"
                >
                    <h2 class="text-lg font-bold text-gray-900 mb-2">
                        Resumo do Pedido
                    </h2>

                    <p class="text-sm text-gray-500 mb-6">
                        {totalItems} produtos selecionados
                    </p>

                    <div class="py-6 border-t border-gray-100">
                        <div class="flex justify-between items-end mb-1">
                            <span class="text-base font-bold text-gray-900"
                                >Total</span
                            >
                            <span class="text-3xl font-bold text-blue-900"
                                >{formatPrice(cartTotal)}</span
                            >
                        </div>
                        <p class="text-xs text-gray-500 text-right mb-6">
                            Frete, taxas e cupons calculados no checkout
                        </p>

                        <button
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition transform hover:-translate-y-1 flex justify-center items-center group"
                        >
                            Ir para o Checkout <i
                                class="fas fa-arrow-right ml-2 text-green-100 group-hover:text-white transition"
                            ></i>
                        </button>
                    </div>

                    <div
                        class="mt-4 flex justify-center space-x-3 text-gray-400 text-2xl"
                    >
                        {
                            paymentMethods.map((method) => (
                                <i
                                    class={`${method.icon} ${method.colorClass} transition cursor-pointer`}
                                />
                            ))
                        }
                    </div>
                </div>
            </div>
        </div>
    </main>
    <Footer />
</Layout>
