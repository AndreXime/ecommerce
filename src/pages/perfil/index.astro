---
import Layout from "@/layout/layout.astro";
import AccountDashboard from "./_profile";
import Header from "@/components/Header.astro";
import { serverGet } from "@/lib/serverApi";
import type { User } from "@/database/users";

export const prerender = false;

const cookieHeader = Astro.request.headers.get("cookie");

const { data: userData, status } = await serverGet<User>("/users/me", cookieHeader);

if (status === 401 || !userData) {
    return Astro.redirect("/login");
}
---

<Layout
    title="Minha Conta | Emporium da Tecnologia"
    description="Gerencie seus pedidos e dados"
>
    <Header hideSearch />

    <main class="flex-grow container mx-auto px-4 py-8 bg-gray-50 min-h-[85vh]">
        <AccountDashboard client:load user={userData} />
    </main>

    <footer
        class="mt-auto py-8 text-center text-sm text-gray-400 border-t border-gray-200 bg-white"
    >
        <p>&copy; 2024 Emporium da Tecnologia, Inc.</p>
    </footer>

    <style is:inline>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOverlay {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        .animate-fade-overlay { animation: fadeOverlay 0.2s ease-out forwards; }
        .animate-scale-in { animation: scaleIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
    </style>
</Layout>
